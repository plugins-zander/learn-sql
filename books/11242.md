# SQL Server

### 4.3.3 日期时间型

　　日期时间型，包括两种：datetime和smalldatetiime。日期时间型既可以用于存储时间型数据，也可以用于存储日期型数据。

　　自从SQL Server 2012开始，新增了4种与日期时间相关的新数据类型：datetime2、dateoffset、date和time。

  日期时间型数据类型（float和real）

| 数据类型          | 说明                                                         |
| ----------------- | ------------------------------------------------------------ |
| date              | 占3字节，只存储日期（无时间部分），可存储从1年1月1日到9999年12月31日的日期数据 |
| time(n)           | 占3至5字节，只存储时间，n取值在0~7之间，存储格式为“HH:MM:SS[.NNNNNNN]”，其中HH,MM,SS分别表示小时、分和秒，N表示秒的小数位，取值范围从00:00:00.0000000到23:59:59.9999999，精确到100纳秒 |
| smalldatetime     | 占4个字节，可存储从1900年1月1日到2079年6月6日的日期和时间数据，精确到分钟 |
| datetime          | 占8个字节，可存储从1753年1月1日到9999年12月31日的日期和时间数据，精确到千分之三秒（即3.33毫秒） |
| datetime2(n)      | 占6至8字节，可存储从1年01月01日00时00分00.0000000秒到9999年12月31日23时59分59.9999999秒的日期和时间数据，n取值在0~7之间的数，指定秒的小数位，精确到100钠秒 |
| datetimeoffset(n) | 占8至10字节，可存储从1年01月01日00时00分00.0000000秒到9999年12月31日23时59分59.9999999秒的日期和时间数据，n取值在0~7之间的数，指定秒的小数位，精确到100钠秒。该类型带有时区偏移量，时区偏移量最大为+/-14小时，包含了UTC偏移量，因此可以合理化不同时区捕捉的时间 |



**Date 类型：**

| 数据类型       | 描述                                                         | 存储      |
| -------------- | ------------------------------------------------------------ | --------- |
| datetime       | 从 1753 年 1 月 1 日 到 9999 年 12 月 31 日，精度为 3.33 毫秒。 | 8 字节    |
| datetime2      | 从 1753 年 1 月 1 日 到 9999 年 12 月 31 日，精度为 100 纳秒。 | 6-8 字节  |
| smalldatetime  | 从 1900 年 1 月 1 日 到 2079 年 6 月 6 日，精度为 1 分钟。   | 4 字节    |
| date           | 仅存储日期。从 0001 年 1 月 1 日 到 9999 年 12 月 31 日。    | 3 bytes   |
| time           | 仅存储时间。精度为 100 纳秒。                                | 3-5 字节  |
| datetimeoffset | 与 datetime2 相同，外加时区偏移。                            | 8-10 字节 |
| timestamp      | 存储唯一的数字，每当创建或修改某行时，该数字会更新。timestamp 值基于内部时钟，不对应真实时间。每个表只能有一个 timestamp 变量。 |           |



```
日期时间类型

日期时间类型数据用于存储日期和时间信息，在SQL Server 2008以前的版本中，日期时间数据类型只有datetime和smalldatetime两种。而在SQL Server 2008中新增了4种新的日期时间数据类型，分别为date、time、datetime2和datetimeoffset。

（1）datetime：datetime类型可表示的日期范围为从1753年1月1日到9999年12月31日，精确度为0.03 s（3.33 ms或0.003 33 s），例如，1～3 ms的值都表示为0 ms，4～6 ms的值都表示为4 ms。
datetime类型数据长度为8字节，日期和时间分别使用4字节存储。前4字节用于存储datetime类型数据中距1900年1月1日的天数。为正数表示日期在1900年1月1日之后，为负数则表示日期在1900年1月1日之前。后4字节用于存储datetime类型数据中距12:00（24小时制）的毫秒数。

（2）smalldatetime：smalldatetime类型数据可表示从1900年1月1日到2079年6月6日的日期和时间，数据精确到分钟。即29.998 s或更低的值向下舍入为最接近的分钟，29.999 s或更高的值向上舍入为最接近的分钟。
smalldatetime类型数据的存储长度为4字节，前2字节用来存储smalldatetime类型数据中日期部分距1900年1月1日之后的天数。后2字节用来存储smalldatetime类型数据中时间部分距中午12点的分钟数。
用户输入smalldatetime类型数据的格式与datetime类型数据完全相同，只是它们的内部存储可能不相同。

（3）date：date类型数据可以表示从公元元年1月1日到9999年12月31日的日期，date类型只存储日期数据，不存储时间数据，存储长度为3字节，表示形式与datetime数据类型的日期部分相同。

（4）time：time数据类型只存储时间数据，表示格式为“hh:mm:ss[.nnnnnnn]”。hh表示小时，范围为0～23。mm表示分钟，范围为0～59。ss表示秒数，范围为0～59。n是0～7位数字，范围为0～999 9999，表示秒的小数部分，即微秒数。所以time数据类型的取值范围为00:00:00.000 000 0～23:59:59.999 999 9。time类型的存储大小为5字节。另外还可以自定义time类型微秒数的位数，例如，time(1)表示小数位数为1，默认为7。

（5）datetime2：新的datetime2数据类型和datetime类型一样，也用于存储日期和时间信息。但是datetime2类型取值范围更广，日期部分取值范围从公元元年1月1日到9999年12月31日，时间部分的取值范围为00:00:00.0000000～23:59:59.999999。另外，用户还可以自定义datetime2数据类型中微秒数的位数，例如，datetime(2)表示小数位数为2。datetime2类型的存储大小随着微秒数的位数（精度）而改变，精度小于3时为6字节，精度为4和5时为7字节，所有其他精度则需要8字节。


（6）datetimeoffset：datetimeoffset数据类型也用于存储日期和时间信息，取值范围与datetime2类型相同。但datetimeoffset类型具有时区偏移量，此偏移量指定时间相对于协调世界时（UTC）偏移的小时和分钟数。datetimeoffset的格式为“YYYY-MM-DD hh:mm:ss[.nnnnnnn] [{+|}hh:mm]”，其中，hh为时区偏移量中的小时数，范围为00～14，mm为时区偏移量中的额外分钟数，范围为00～59。时区偏移量中必须包含“+”（加）或“–”（减）号。这两个符号表示是在UTC时间的基础上加上还是从中减去时区偏移量以得出本地时间。时区偏移量的有效范围为14:00～+14:00。




时间戳型

标识符是timestamp。若创建表时定义一个列的数据类型为时间戳类型，那么每当对该表加入新行或修改已有行时，都由系统自动将一个计数器值加到该列，即将原来的时间戳值加上一个增量。

记录timestamp列的值实际上反映了系统对该记录修改的相对（相对于其他记录）顺序。一个表只能有一个timestamp 列。timestamp类型数据的值实际上是二进制格式数据，其长度为8字节。

```
用户给出datetime类型数据值时，日期部分和时间部分分别给出。
日期部分的表示形式常用的格式如下：

| 年 月 日    | 2001 Jan 20、2001 Janary 20              |
| ----------- | ---------------------------------------- |
| 年 日 月    | 2001 20 Jan                              |
| 月 日[,]年  | Jan 20 2001、Jan 20,2001、Jan 20,01      |
| 月 年 日    | Jan 2001 20                              |
| 日 月[,]年  | 20 Jan 2001、20 Jan,2001                 |
| 日 年 月    | 20 2001 Jan                              |
| 年（4位数） | 2001表示2001年1月1日                     |
| 年月日      | 20010120、010120                         |
| 月/日/年    | 01/20/01、1/20/01、01/20/2001、1/20/2001 |
| 月-日-年    | 01-20-01、1-20-01、01-20-2001、1-20-2001 |
| 月.日.年    | 01.20.01、1.20.01、01.20.2001、1.20.2001 |

时间部分常用的表示格式如下：

| 时:分         | 10:20、08:05         |
| ------------- | -------------------- |
| 时:分:秒      | 20:15:18、20:15:18.2 |
| 时:分:秒:毫秒 | 20:15:18:200         |
| 时:分AM\|PM   | 10:10AM、10:         |