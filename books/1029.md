

# E-R图

概念模型有很多种表示方法,其中最为常用的是 P . P . S . Chen 于1976年提出的实体-联系方法(Entity Relationship Approach )。该方法用 E - R 图来描述现实世界的概念模型,称为实体-联系模型( Entity-Relationship Model , E-R 模型)。

E - R 模型是软件工程设计中的一个重要方法,因为它接近于人的思维方式,容易理解并且与计算机无关,所以用户容易接受,是用户和数据库设计人员交流的语言。但是, E - R 模型只能说明实体间的语义联系,还不能进一步地详细说明数据结构。在解决实际应用问题时,通常先设计一个 E - R 模型,然后再把其转换成计算机能接受的数据模型。





### 实体及其联系

#### 1.实体

在 E - R 模型中,实体用矩形表示,通常矩形框内写明实体名。实体是现实世界中可以区别于其他对象的“事件”或“物体”。例如,企业中的每个人都是一个实体。每个实体由一组特性(属性)来表示,其中的某一部分属性可以唯一标识实体,例如职工实体集中的职工号。实体集是具有相同属性的实体集合。例如,学校的所有教师具有相同的属性,因此教师的集合可以定义为一个实体集;学生具有相同的属性,因此学生的集合可以定义为另一个实体集。

- **实体**是客观存在的并可以相互区分的事物。
- **实体的属性**是指实体所具有的特性。

> Ø eg：学生是一个实体，如姓名、性别、成绩等是实体的属性。

- **码**又称**关键字**，它是一个或者多个属性的集合。

> Ø eg：学号是学生实体的码。

- **属性的域**是指一个属性的取值范围。

> Ø eg：成绩是学生实体的域。

- **实体型**是指用实体名和实体属性名的集合来共同刻画同一类实体。

> Ø  eg：学生（学号，姓名，性别，籍贯，成绩）是一个实体型。

- **实体集**就是实体的集合。

> 实体及其属性的表示

> 【例子】 对于一个实体型——学生（学号，姓名，成绩），其E-R图如图1.10所示。

 ![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191025233644.png)







#### 2.联系

在 E - R 模型中,联系用菱形表示,通常菱形框内写明联系名,并用无向边分别与有关实体连接起来,同时在无向边旁标注上联系的类型(1:1、1 : n 或 m : n)。实体的联系分为实体内部的联系和实体与实体之间的联系。实体内部的联系反映数据在同一记录内部各字段间的联系。

Ø 定义：是指事物之间的关系（现实世界）在信息世界中的反映。

Ø 两种类型： 实体内部的联系和实体之间的联系。

Ø 三种联系类型

假设A和B分别表示两个实体集

•         一对一联系记为（1:1）。

•         一对多联系记为（1:n）。

•         多对多联系记为（m:n）。



两个不同实体之间的联系,两个不同实体集之间存在以下3种联系类型。
• 一对一(1 : 1)。指实体集$E_1$在中的一个实体最多只与实体集$E_2$中的一个实体相联系。
• 一对多(1 : n)。表示实体集$E_1$中的一个实体可与实体集$E_2$中的多个实体相联系。
•多对多( m :n)。表示实体集$E_1$中的多个实体可与实体集$E_2$中的多个实体相联系。

> 当将现实世界中的实际问题转化为信息世界中的概念模型时，用什么来描述这种概念模型呢?当在数据库理论中，通常用E-R图来描述概念模型 ，它提供了表示实体型、属性和联系的方法。

- 实体型之间联系的表示

  两个实体型之间联系的表示

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191025233728.png)

 

　　多个实体型（三个或三个以上）之间联系的表示

Ø 三个实体型A、B、C之间联系表示为（m:n:o）,其中m,n,o > 0。

【例子】 对于供应商、仓库和零件，由于一个供应商可以提供多种零件并存放在不同仓库中，而一种零件也可以由多个供应商提供并存放在不同仓库中，同时一个仓库也可以存放不同供应商提供的多种零件。所以供应商、仓库和零件之间的联系是多对多联系，其E-R图可以用图1.12表示。

 ![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191025233756.png)

3.实体型内部联系的表示

　　同一个实体型内部实体的三种联系对应的E-R图，分别如图1.13的（a）、（b）和（c）所示。

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191025233818.png)

 

 

#### 联系属性的表示

　　联系的属性的表示方法与实体的类似

Ø 对于供应商和仓库之间的联系（库存），其属性（库存量），可以表示如图1.15所示。



![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191025233923.png)



 

#### 总结

　　利用实体、属性和联系及其之间关系的表示方法可以将现实世界中的复杂问题抽象成为信息世界中的概念模型。概念模型通常是用E-R图表示的，E-R图的设计过程就是对问题进行抽象和建模的过程。

 





　　概念结构设计通常采用的是自底向上的设计方法（而需求分析一般是采用自顶向下的方法），即这种方法分为两步：

- 先建立局部概念结构的E-R模型；
- 然后将所有的局部E-R模型集成起来形成全局概念结构。

 

以下主要介绍这种自底向上的概念结构设计方法：

步骤一： 局部E-R模型的设计

　　E-R模型的设计基于需求分析阶段产生的数据流图和数据字典来进行。一个系统的数据流图是按分层来绘制，是由多张数据流图构成。基于一张数据流图及其对应的数据字典部分进行的E-R模型设计得到的是一个局部概念。

实体和实体间联系的划分并无统一的标准，一般采用的划分原则是，先是凭经验，后再作调整。

　　经验是指在一般情况下对于那些具有共同特征和行为的对象，可以将之抽象为实体；对象的共同特征和行为可以抽象为实体的属性。

　　调整是指在凭经验作出抽象后，根据具体的应用和建模环境对实体与其属性之间的关系以及实体与实体之间的关系作出相应的更改，有可能使得原来的属性变为实体，原来是实体的变为属性等，从而也导致了实体间关系的改变。

 

实体及实体间关系的抽象注意以下三点：

   （1）在同一应用环境中，被抽象为属性的事物就不能再被抽象为实体了，否则会导致“属性又包含属性”的错误，这违反第一范式；

   （2）属性具有不可再分性，所以具有不可再分性的事物一般都应抽象为属性，而具有可再分性的事物一般不能抽象为属性；

   （3）一个事物不能同时被抽象为两个实体的属性，即一个属性只能隶属于一个实体。

 

【例子】  对于一个企业信息管理系统来说，企业中的工作人员可以抽象为“职工”实体，而工作人员的姓名、性别、年龄、职称、所在部门等可以抽象为“职工”实体的属性，如图3.4所示。

 

 

【例子】  如果在这个系统中除了“职工”信息以外还需要考虑部门的一些信息，如部门的名称、人数、经理、位置等信息，那就应该对前面的抽象作调整：应该将“部门”由原来作为“职工”的属性改为一个新的实体——“部门”实体，同时原来作为属性的“部门”被删除（这避免了一个事物既作为属性又作为实体的情况出现）。这两个实体的关系是“部门”拥有“职工”（或者“职工”隶属于“部门”），即“拥有”是这两个实体之间的联系。这样，原来的E-R图进一步得到调整和扩充，如图3.5所示。

 

 

从需求分析中发现，部门中的职工所做的工作是开发项目，用于说明项目的信息包括项目名称、项目性质、项目开发的起始时间、项目经费、项目经理等。将项目抽象为实体，形成“项目”实体，其E-R图如图3.6所示。

 

 

步骤二：全局E-R模型的集成

相对于一个整体而言，以上是E-R局部图，这些E-R图应该能够合成一张总的E-R图。对概念结构来说，就是将局部概念结构集成为全局的概念结构。

【例子】 根据需求分析结果，在这个企业中每个部门都有承接多个项目的可能，每个职工只参加一个项目。将图3.5和图3.6所示的E-R图并接起来，结果得到了整个系统的E-R图，如图3.7所示。



 

 

　　局部E-R图的并接过程中产生许多问题，这些问题主要体现为各个局部E-R图之间的冲突，其中包括命名冲突、属性冲突和结构冲突等。

- 命名冲突

命名冲突是指意义不同的元素在不同的局部E-R图中有相同的名字，或者是有相同意义的元素在不同的局部E-R图中具有不相同的名字。

- 属性冲突

 属性冲突是指同义同名的属性在不同的局部E-R图中的取值类型、范围、所使用的单位等却完全不一样。

  【例子】 有的将职工编号定义为长度为12个字节的字符串类型，有的则定义为8个字节的字符串类型，有的可能将职工编号定义为整型。

在一个E-R图中不应该存在属性冲突。

- 结构冲突

结构冲突是指一个事物在一个局部E-R图被抽象为实体，而在另一个局部E-R图中又被抽象为属性。

　　这不能直接将这两个局部E-R图并接为一个E-R图，首先要解决结构冲突问题。解决的办法是，视具体情况将相应的属性改为实体，或者将相应的实体改为属性。

　　还有一种结构冲突是相同的实体在不同的局部E-R图中有不同的属性或不同的联系。对于前一种情况，一种简单的解决方法是：使该实体的属性集为它在各E-R图中的属性集的并；对于后一种情况，解决方法相对复杂，要视具体情况对联系进行分解，或者进行其他的调整。

 

　　在构建的E-R图中，最好不要包含环形结构，因为这容易出现“死循环”参照关系。

【例子】 假设实体X、Y和Z以及它们之间的联系a、b和c构成如图3.8所示的E-R图，则该E-R图出现“死循环”问题，因为在据此图建立数据表时，将出现X参照Y、Y参照Z、Z参照X的“死循环”参照关系，从而无法创建数据表。因此，如果一个E-R图包含环形结构，则需要进一步确认对概念结构的建模是否正确？重新修改E-R图，或者直接将环中的一条边（关联）去掉，以破坏“死循环”结构。

 

 

 

3.1.3步骤

　　概念结构设计中，实体集中的实体彼此是可区别的。如果实体集中的属性或最小属性组合的值能唯一标识其对应实体，则将该属性或属性组合称为码。对于每一个实体集，可指定一个码为主码。

　　如果用矩形框表示实体集，用带半圆的矩形框表示属性，用线段连接实体集与属性，当一个属性或属性组合指定为主码时，在实体集与属性的连接线上标记一斜线，则可以用图1.4描述学生成绩管理系统中的实体集及每个实体集涉及的属性。

 

 

图1.4 学生和课程实体集属性的描述   其中 \主键

1．一对一的联系（1 : 1）

A中的一个实体至多与B中的一个实体相联系，B中的一个实体也至多与A中的一个实体相联系。例如，“班级”与“正班长”这两个实体集之间的联系是一对一的联系，因为一个班级只有一个正班长，反过来，一个正班长只属于一个班级。“班级”与“正班长”两个实体集的E-R模型如图1.5所示。



 

 

2．一对多的联系（1 : n）

A中的一个实体可以与B中的多个实体相联系，而B中的一个实体至多与A中的一个实体相联系。例如，“班级”与“学生”这两个实体集之间的联系是一对多的联系，因为，一个班级可有若干学生，反过来，一个学生只能属于一个班级。“班级”与“学生”两个实体集的E-R模型如图1.6所示。

 

 

 

 

3．多对多的联系（m : n）

A中的一个实体可以与B中的多个实体相联系，而B中的一个实体也可与A中的多个实体相联系。例如，“学生”与“课程”这两个实体集之间的联系是多对多的联系，因为，一个学生可选多门课程，反过来，一门课程可被多个学生选修。“学生”与“课程”两个实体集的E-R模型如图1.7所示。

 

注意：实体图ER图可以分开

