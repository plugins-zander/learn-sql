# 关系运算



 关系一些特殊的运算，主要包括选择（σ）、投影（π）、连接（⋈ ）、除（/）等。

Ø  先约定一种表示方法：设*x*为某一个关系*R*的一个元组，*L*为*R*的关系模式的一个子集（即属性子集），则令*x*(*L*)表示由元组*x*在属性子集*L*上的所有分量构成的新元组。

【例子】对于关系R(A,B,C,D)，令x = (a , b ,c , d)，则x({A,B,C}) = (a , b , c)，x({C,D}) = (c , d)，x({B}) = (b)，等。

 

 

•                 选择σ

  从关系中筛选出满足既定条件的元组，这些元组组成了一个新的关系，这个操作过程称为选择。

Ø  选择的操作符用*σ*表示，选择条件则用逻辑公式来表示，用*R*表示逻辑公式。对关系R的选择运算就可以表示为σ*t*(*R*)，即

σ*t*(*R*) = {*x* | *x*∈*R*∧*t*(*x*) = true}

　　　　“*t*(*x*) = true”表示元组*x*满足条件公式*t*。对于选择运算，关键是设置选择条件*t*。

　　　　在数据查询中，条件公式*t*通常是由<、>、≤、≥、=、between、∧、∨等连接符号构成的条件表达式或逻辑表达式。

 

 

【例子】表2.3所示的学生关系student。令选择条件t = (性别=‘男’∧专业号=‘z3’)，则选择运算*s**t**(*student)表示查找那些专业号为“z3”的男同学，结果如表2.7所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620025725167-534615720.png)

 

 

\2. 投影π

l  投影是指从关系中选出若干个指定的属性来组成新的关系。令投影的操作符为π，*L*为指定的属性子集，则关系*R*在属性子集*L*上的投影就可以表示为π*L*(*R*)，即 *πL*(*R*) = {*x*(*L*) | *x* ∈ *R*}

​                           *x*(*L*)表示由元组*x*在属性集*L*上的取值构成的新元组。

l  投影还有一种表示方法就是在投影运算表达式*π**L*(*R*)中用指定的属性在关系*R*中的序号来代替*L*中的属性名。

 【例子】对于上述的投影*π*{姓名，性别} (student)也可以表示为*π*{2，3}(student)。

l  投影就是从关系表中按指定的属性抽取相应的列，这些列组成一个新的关系。

l  注意，**投影运算是对列进行筛选**，**而选择运算则对行进行筛选**。

 

 

【例子】对于表2.3所示的学生关系student，令*L* = {姓名，性别}，则学生关系在*L*上的投影：

​         *πL*(student)  = {*x*(*L*) | *x*∈  *R*}

​      = {*x*({姓名，性别}) | *x*∈  *R*}

​      = {(刘洋,男), (李思思,女), (陈永江,男), (王大河,男), (吕文星,男), (李鑫,女)}

 

结果如表2.8所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620030200454-1096581292.png)

 

 

\3. 连接  ⋈

   连接运算是二元运算，即涉及到两个关系的运算。假设参与运算的两个关系是*R*和*S*，则连接运算的结果是*R*和*S*笛卡儿积中满足属性间既定条件的元组的集合，即它是*R*和*S*笛卡儿积的一个子集。连接运算常用的主要有两种：等值连接和自然连接。

1）等值连接

​     对于关系R和S，假设F和M分别是关系模式R和S的属性子集，如果按照F和M进行连接，则R和S的等值连接表示为：

 *![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620030239763-1254773254.png)*

*xr**xs*表示由元组*xr*和*xs*连接起来而构成的新元组。等值连接R    S是R和S笛卡儿积的一个子集，子集中的元组在F和M上的取值相等。

 

 

2）自然连接

   自然连接是一种特殊的等值连接，它是在等值连接的基础上加上两个条件：

（1）参与比较的属性子集*F* 和*M* 必须是相同的，即*F*=*M*；

（2）形成的新关系中不允许存在重复的属性，如果有则去掉。*R*和*S*的自然连接可以表示为：![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620030456041-1602364949.png)

F是关系R和S都包含的属性（组）。

 

 

 

 表2.9和表2.10所示的两个关系，分别表示学生的基本信息和学生的考试成绩。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620030646487-1372819323.png)

等值连接stu_info⋈ 年龄=高数grade和stu_info⋈ 姓名=姓名grade以及

自然连接stu_info ⋈ 姓名grade的结果分别见表2.11、表2.12和表2.13所示。

从这三个结果的对比中读者不难比较这几种连接的区别。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620030735966-296084086.png)

 

 

\4. 除/   

 

对于关系模式*R*(*LR*)和*S*(*LS*)，约定：

​     *LR* --- *R*的属性集

​     *LS* --- *S*的属性集

​     *L* = *LR* ∩*LS*    (即*L*表示关系*R*和关系*S*的公共属性)

​     *Lx* = {*t*(*L*) | *t*∈*R*∧*t*(*LR-L*)=*x*}       (其中，*x*∈πLR -L（R） ，*Lx*称为*x*在*R*中关于*L*的像集)

 

​    *R*和*S*的除运算产生一个新关系*R/S*：

​         该新关系由投影 *x*∈πLR -L（R）中的某些元组组成，这些元组在*R*中关于*L*的像集包含*S*在*L*上的投影π*L*(*S*)。即：

![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620155305767-1462483673.png)

*相同部分所在行*

 

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620031404369-1895712602.png)