# 概念结构设计

### 3.1.1概念结构定义

　　需求分析的成果是数据流图和数据字典，概念结构设计的目的就是将抽象转化为信息世界中基于信息结构表示的数据结构——概念结构，即概念结构是用户需求在信息世界中的模型。

　　数据库的概念结构独立于它的逻辑结构，更与数据库的物理结构无关。它是现实世界中用户需求与机器世界中机器表示之间的中转站。它既有易于用户理解、实现分析员与用户交流的优点，也有易于转化为机器表示的特点。当用户的需求发生改变时，概念结构很容易作出相应的调整。所以，概念结构设计是数据库设计的一个重要步骤。

　　概念模式描述的经典工具是E-R图，由E-R图表示的概念模型就是所谓的E-R模型。E-R模型的创建和设计过程就是概念结构的创建和设计过程，概念结构的设计集中体现为E-R模型的设计。

E-R模型的优点：

　　它具有较强的表达能力，可以充分表示各种类型数据及数据之间的联系；

　　数据表达形式简单，没有过多的概念，定义严格，无二义性等；

　　E-R模型是以图形的形式出现，表示直观。

 

 

### 3.1.2设计思想

　　四种概念结构的设计指导思想：

**自顶向下**：首先根据用户需求定义全局概念结构的E-R模型，然后对其分解，逐步细化。

**自底向上**：首先根据各个部门的需求定义局部概念结构的E-R模型，然后将这些局部的E-R模型并接成为全局的E-R模型，形成全局概念结构。

**先主后次**：分析各种子需要的“轻重”，首先设计最重要的概念结构，形成它的E-R模型，然后定义次要概念结构的E-R模型，接着按照类似的方法定义其他所有概念结构的E-R模型，最后将这些模型继承起来，形成全局概念结构。

**上下混合**：这是指将自顶向下和自底向上这两种方法结合起来使用的一种设计方法。

 

　　概念结构设计通常采用的是自底向上的设计方法（而需求分析一般是采用自顶向下的方法），即这种方法分为两步：

- 　　先建立局部概念结构的E-R模型；
- 　　然后将所有的局部E-R模型集成起来形成全局概念结构。

 

以下主要介绍这种自底向上的概念结构设计方法：

#### 步骤一： 局部E-R模型的设计

　　E-R模型的设计基于需求分析阶段产生的数据流图和数据字典来进行。一个系统的数据流图是按分层来绘制，是由多张数据流图构成。基于一张数据流图及其对应的数据字典部分进行的E-R模型设计得到的是一个局部概念。

实体和实体间联系的划分并无统一的标准，一般采用的划分原则是，先是凭经验，后再作调整。

　　经验是指在一般情况下对于那些具有共同特征和行为的对象，可以将之抽象为实体；对象的共同特征和行为可以抽象为实体的属性。

　　调整是指在凭经验作出抽象后，根据具体的应用和建模环境对实体与其属性之间的关系以及实体与实体之间的关系作出相应的更改，有可能使得原来的属性变为实体，原来是实体的变为属性等，从而也导致了实体间关系的改变。

 

实体及实体间关系的抽象注意以下三点：

   （1）在同一应用环境中，被抽象为属性的事物就不能再被抽象为实体了，否则会导致“属性又包含属性”的错误，这违反第一范式；

   （2）属性具有不可再分性，所以具有不可再分性的事物一般都应抽象为属性，而具有可再分性的事物一般不能抽象为属性；

   （3）一个事物不能同时被抽象为两个实体的属性，即一个属性只能隶属于一个实体。

 

【例子】  对于一个企业信息管理系统来说，企业中的工作人员可以抽象为“职工”实体，而工作人员的姓名、性别、年龄、职称、所在部门等可以抽象为“职工”实体的属性，如图3.4所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620182605049-802841897.png)

 

【例子】  如果在这个系统中除了“职工”信息以外还需要考虑部门的一些信息，如部门的名称、人数、经理、位置等信息，那就应该对前面的抽象作调整：应该将“部门”由原来作为“职工”的属性改为一个新的实体——“部门”实体，同时原来作为属性的“部门”被删除（这避免了一个事物既作为属性又作为实体的情况出现）。这两个实体的关系是“部门”拥有“职工”（或者“职工”隶属于“部门”），即“拥有”是这两个实体之间的联系。这样，原来的E-R图进一步得到调整和扩充，如图3.5所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620182625638-2097599860.png)

 

从需求分析中发现，部门中的职工所做的工作是开发项目，用于说明项目的信息包括项目名称、项目性质、项目开发的起始时间、项目经费、项目经理等。将项目抽象为实体，形成“项目”实体，其E-R图如图3.6所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620182655339-1736994574.png)

 

#### 步骤二：全局E-R模型的集成

相对于一个整体而言，以上是E-R局部图，这些E-R图应该能够合成一张总的E-R图。对概念结构来说，就是将局部概念结构集成为全局的概念结构。

【例子】 根据需求分析结果，在这个企业中每个部门都有承接多个项目的可能，每个职工只参加一个项目。将图3.5和图3.6所示的E-R图并接起来，结果得到了整个系统的E-R图，如图3.7所示。

![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620182915020-1944032690.png)

 

 

　　局部E-R图的并接过程中产生许多问题，这些问题主要体现为各个局部E-R图之间的冲突，其中包括命名冲突、属性冲突和结构冲突等。

- 命名冲突

命名冲突是指意义不同的元素在不同的局部E-R图中有相同的名字，或者是有相同意义的元素在不同的局部E-R图中具有不相同的名字。

- 属性冲突

 属性冲突是指同义同名的属性在不同的局部E-R图中的取值类型、范围、所使用的单位等却完全不一样。

  【例子】 有的将职工编号定义为长度为12个字节的字符串类型，有的则定义为8个字节的字符串类型，有的可能将职工编号定义为整型。

在一个E-R图中不应该存在属性冲突。

- 结构冲突

结构冲突是指一个事物在一个局部E-R图被抽象为实体，而在另一个局部E-R图中又被抽象为属性。

　　这不能直接将这两个局部E-R图并接为一个E-R图，首先要解决结构冲突问题。解决的办法是，视具体情况将相应的属性改为实体，或者将相应的实体改为属性。

　　还有一种结构冲突是相同的实体在不同的局部E-R图中有不同的属性或不同的联系。对于前一种情况，一种简单的解决方法是：使该实体的属性集为它在各E-R图中的属性集的并；对于后一种情况，解决方法相对复杂，要视具体情况对联系进行分解，或者进行其他的调整。

 

　　在构建的E-R图中，最好不要包含环形结构，因为这容易出现“死循环”参照关系。

【例子】 假设实体X、Y和Z以及它们之间的联系a、b和c构成如图3.8所示的E-R图，则该E-R图出现“死循环”问题，因为在据此图建立数据表时，将出现X参照Y、Y参照Z、Z参照X的“死循环”参照关系，从而无法创建数据表。因此，如果一个E-R图包含环形结构，则需要进一步确认对概念结构的建模是否正确？重新修改E-R图，或者直接将环中的一条边（关联）去掉，以破坏“死循环”结构。

 ![img](https://img2018.cnblogs.com/blog/1427277/201906/1427277-20190620183143341-1882404306.png)

 

 

### 3.1.3步骤 

　　概念结构设计中，实体集中的实体彼此是可区别的。如果实体集中的属性或最小属性组合的值能唯一标识其对应实体，则将该属性或属性组合称为码。对于每一个实体集，可指定一个码为主码。

　　如果用矩形框表示实体集，用带半圆的矩形框表示属性，用线段连接实体集与属性，当一个属性或属性组合指定为主码时，在实体集与属性的连接线上标记一斜线，则可以用图1.4描述学生成绩管理系统中的实体集及每个实体集涉及的属性。

 

 ![img](https://img2018.cnblogs.com/blog/1427277/201909/1427277-20190904112430705-1235194474.png)

图1.4 学生和课程实体集属性的描述   其中 \主键

1．一对一的联系（1 : 1）
A中的一个实体至多与B中的一个实体相联系，B中的一个实体也至多与A中的一个实体相联系。例如，“班级”与“正班长”这两个实体集之间的联系是一对一的联系，因为一个班级只有一个正班长，反过来，一个正班长只属于一个班级。“班级”与“正班长”两个实体集的E-R模型如图1.5所示。

![img](https://img2018.cnblogs.com/blog/1427277/201909/1427277-20190909213251074-585207730.png)

 

 

2．一对多的联系（1 : n）
A中的一个实体可以与B中的多个实体相联系，而B中的一个实体至多与A中的一个实体相联系。例如，“班级”与“学生”这两个实体集之间的联系是一对多的联系，因为，一个班级可有若干学生，反过来，一个学生只能属于一个班级。“班级”与“学生”两个实体集的E-R模型如图1.6所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201909/1427277-20190909213309728-1450246700.png)

 

 

 

3．多对多的联系（m : n）
A中的一个实体可以与B中的多个实体相联系，而B中的一个实体也可与A中的多个实体相联系。例如，“学生”与“课程”这两个实体集之间的联系是多对多的联系，因为，一个学生可选多门课程，反过来，一门课程可被多个学生选修。“学生”与“课程”两个实体集的E-R模型如图1.7所示。

 ![img](https://img2018.cnblogs.com/blog/1427277/201909/1427277-20190909213333843-124026803.png)

注意：实体图ER图可以分开

 

 

 