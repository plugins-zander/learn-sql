# 自定义数据类型

## 概念

根据实际需要，用户可利用已有的标准数据类型来定义自己的数据类型，这种类型称为自定义数据类型。自定义数据类型可由**CREATE TYPE**语句来定义。

用户自定义数据类型可看做**系统数据类型的别名**。

在多表操作的情况下，当多个表中的列要存储相同类型的数据时，往往要确保这些列具有完全相同的数据类型、长度和为空性（数据类型是否允许空值）。用户自定义数据类型并不是真正的数据类型，它只是提供了一种提高数据库内部元素和基本数据类型之间一致性的机制。

> 类似于#define，方便管理，改一处，都改



```sql
【例子】 用户可以用下列语句创建表示地址的数据类型——address：
CREATE TYPE address FROM varchar(350) NOT NULL;
执行上述语句后，就生成了名为address的数据类型，同时增加了约束条件——NOT NULL。就可以用address去定义字段和变量。该数据类型就是与varchar(350)同等，只不过它增加了一个非空约束条件。

不再需要数据类型address，可以用下列语句将之删除：
 DROP TYPE address;
但在删除之前，先删除所有引用该数据类型的数据库对象。
```



## 定义类型

要使用用户自定义类型，首先应定义该类型，然后用这种类型来定义字段或变量。在创建用户自定义数据类型时首先应考虑如下三个属性： 

   数据类型名称；
   新数据类型所依据的系统数据类型（又称为基类型）；
   为空性。如果为空性未明确定义，系统将依据数据库或连接的ANSI Null 默认设置进行指派。



使用命令定义。在SQL Server 2008中，使用CREATE TYPE语句来实现用户数据类型的定义。语法格式：
```sql
CREATE TYPE [ schema_name. ] type_name
    FROM base_type [ ( precision [ , scale ] ) ]
    [ NULL | NOT NULL ] 
[ ; ]
```



```sql
例子：用户自定义数据类型student_num后，可以重新设计学生成绩管理数据库表XSB、CJB结构中的学号字段，如表5.4、表5.5和表5.6所示。
```

表5.4  自定义类型student_num

| 依赖的系统类型 | 值允许的长度 | 为  空  性 |
| -------------- | ------------ | ---------- |
| char           | 6            | NOT NULL   |

表5.5  表XSB中学号字段的重新设计              

| 字  段  名 | 类    型    |      | 字  段  名 | 类    型    |
| ---------- | ----------- | ---- | ---------- | ----------- |
| 学号       | student_num |      | 学号       | student_num |

表5.6  表CJB中学号字段的重新设计

| 字  段  名 | 类    型    |      | 字  段  名 | 类    型    |
| ---------- | ----------- | ---- | ---------- | ----------- |
| 学号       | student_num |      | 学号       | student_num |


```sql
//根据上述语法，定义描述学号字段的数据类型的语句如下：
CREATE TYPE student_num
    FROM char(6) NOT NULL
```





##  使用命令删除用户自定义数据类型

使用命令方式删除自定义数据类型可以使用DROP TYPE语句。语法格式：
```sql
DROP TYPE [ schema_name. ] type_name [ ; ]
```

```sql
例如，删除前面定义的student_num类型的语句为
DROP TYPE student_num
以上语句实际不做操作。
```


## 利用用户自定义数据类型定义字段

在定义类型后，接着应考虑定义这种类型的字段，同样可以利用对象资源管理器和T-SQL命令两种方式实现。可以参照基本数据类型进行定义，不同点只是数据类型为用户自定义类型，而不是系统类型。

```sql
利用命令方式定义XSB表结构：
CREATE TABLE XSB
( 	
	学号   student_num NOT NULL PRIMARY KEY,	/*将学号定义为student_num类型*/
  	姓名 	char(8) 	NOT NULL,
  	性别		bit 		NULL DEFAULT 1,
  	出生时间 datetime 	NULL,
  	专业   	char(12) 	NULL,
  	总学分  	int 		NULL,
  	备注   varchar(500) 	NULL
)
```



# 界面

### 创建用户自定义数据类型的方法如下

#### 使用对象资源管理器定义。步骤如下

```sql
第1步：启动“SQL Server Management Studio”，在“对象资源管理器”中展开“数据库→PXSCJ→可编程性”，右击“类型”，选择“新建”选项，再选择“新建用户定义数据类型”，弹出“新建用户定义数据类型”窗口。
```

```
第2步：在“名称”文本框中输入自定义的数据类型名称，如student_num。在“数据类型”下拉框中选择自定义数据类型所基于的系统数据类型，如char。在“长度”栏中填写要定义的数据类型的长度，如6。其他选项使用默认值，如图5.1所示，单击“确定”按钮即可完成创建。
```

![img](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20200121224931.png)

图5.1  “新建用户定义数据类型属性”窗口

```sql
（3）删除用户自定义数据类型。在SSMS中删除用户自定义数据类型的主要步骤如下：
在对象资源管理器中展开数据库“PXSCJ→可编程性→类型”，在“用户定义数据类型”中选择类型“dbo.student_num”，右击鼠标，在弹出的快捷菜单中选择“删除”菜单项，打开“删除对象”窗口后单击“确定”按钮即可（实际不做操作）。
```


#### 删除用户自定义数据类型。

在SSMS中删除用户自定义数据类型的主要步骤如下：

在对象资源管理器中展开数据库“PXSCJ→可编程性→类型”，在“用户定义数据类型”中选择类型“dbo.student_num”，右击鼠标，在弹出的快捷菜单中选择“删除”菜单项，打开“删除对象”窗口后单击“确定”按钮即可（实际不做操作）。


#### 利用用户自定义数据类型定义字段

例如，在对象资源管理器中对于XSB表学号字段的定义如图5.2所示。

![](https://cdn.jsdelivr.net/gh/ZanderZhao/img20/file/20200121224932.png)

图5.2  使用用户自定义数据类型定义XSB表

















# 用户自定义表数据类型

SQL Server 2008还提供了一种新的用户自定义数据类型，称为用户自定义表数据类型（User-defined Table Types）。这种数据类型也由用户自行定义，可以作为参数提供给语句、存储过程或者函数。创建自定义表数据类型也使用CREATE TYPE语句，语法格式如下：

```sql
CREATE TYPE [ schema_name. ] type_name
  AS TABLE ( <column_definition>
        [ <table_constraint> ] [ ,...n ] )  
[ ; ]


【例5.1】  创建用户自定义表数据类型，包含CJB表中的所有列。
CREATE TYPE CJB_tabletype
    AS TABLE
    (
        学号      char(6) NOT NULL,
        课程号 char(3) NOT NULL,
        成绩      int     NOT NULL,
        PRIMARY KEY(学号, 课程号)    //表级约束，当多个字段时用表级约束
    )
```
















