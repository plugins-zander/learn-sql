# SQL Server

## 表和表结构

每个数据库包含了若干个表。表是SQL Server中最主要的数据库对象，它是用来存储数据的一种逻辑结构。表由行和列组成，因此也称为二维表。表是在日常工作和生活中经常使用的一种表示数据及其关系的形式，表3.1就是用来表示学生情况的一个学生表。

表3.1  学生表

| 学    号 | 姓    名 | 性    别 | 出 生 时 间 | 专    业 | 总  学  分 | 备    注               |
| -------- | -------- | -------- | ----------- | -------- | ---------- | ---------------------- |
| 081101   | 王林     | 男       | 1990-02-10  | 计算机   | 50         |                        |
| 081103   | 王燕     | 女       | 1989-10-06  | 计算机   | 50         |                        |
| 081108   | 林一帆   | 男       | 1989-08-05  | 计算机   | 52         | 已提前修完一门课       |
| 081202   | 王林     | 男       | 1989-01-29  | 通信工程 | 40         | 有一门课不及格，待补考 |
| 081204   | 马琳琳   | 女       | 1989-02-10  | 通信工程 | 42         |                        |
下面简单介绍与表有关的几个概念：

（1）表结构。组成表的各列的名称及数据类型，统称为表结构。

（2）记录。每个表包含了若干行数据，它们是表的“值”，表中的一行称为一个记录。因此，表是记录的有限集合。

（3）字段。每个记录由若干个数据项构成，将构成记录的每个数据项称为字段。例如，表3.1中表结构为（学号，姓名，性别，出生时间，专业，总学分，备注），包含7个字段，由5个记录组成。

（4）空值。空值（NULL）通常表示未知、不可用或将在以后添加的数据。若一个列允许为空值，则向表中输入记录值时可不为该列给出具体值；而一个列若不允许为空值，则在输入时必须给出具体值。

（5）关键字。若表中记录的某一字段或字段组合能唯一标识记录，则称该字段或字段组合为候选关键字（Candidate key）。若一个表有多个候选关键字，则选定其中一个为主关键字（Primary key），也称为主键。当一个表仅有唯一的一个候选关键字时，该候选关键字就是主关键字。这里的主关键字与第1章中的主码所起的作用是相同的，都用来唯一标识记录行。



```

例如，在学生表中，2个及其以上记录的姓名、性别、出生时间、专业、总学分和备注这6个字段的值有可能相同，但是“学号”字段的值对表中所有记录来说一定不同，即通过“学号”字段可以将表中的不同记录区分开来。所以，“学号”字段是唯一的候选关键字，学号就是主关键字。再例如，学生成绩表记录的候选关键字是（学号，课程号）字段组合，它也是唯一的候选关键字。

```





## 视图概念

视图一经定义以后，就可以像表一样被查询、修改、删除和更新。使用视图有下列优点：

（1）为用户集中数据，简化用户的数据查询和处理。有时用户所需要的数据分散在多个表中，定义视图可将它们集中在一起，从而方便用户进行数据查询和处理。

（2）屏蔽数据库的复杂性。用户不必了解复杂的数据库中的表结构，并且数据库表的更改也不影响用户对数据库的使用。

（3）简化用户权限的管理。只需授予用户使用视图的权限，而不必指定用户只能使用表的特定列，也增加了安全性。

（4）便于数据共享。各用户不必都定义和存储自己所需的数据，而可共享数据库的数据，这样，同样的数据只需存储一次。

（5）可以重新组织数据以便输出到其他应用程序中。

在使用视图时，要注意下列事项：

（1）只有在当前数据库中才能创建视图。视图的命名必须遵循标识符命名规则，不能与表同名。

（2）不能把规则、默认值或触发器与视图相关联。







## 游标概念
一个对表进行操作的T-SQL语句通常都可产生或处理一组记录，但是许多应用程序，尤其是T-SQL嵌入到的主语言，通常不能把整个结果集作为一个单元来处理，这些应用程序就需要一种机制来保证每次处理结果集中的一行或几行，游标（cursor）就提供了这种机制。

如果修改字段含义或对字段表示的状态追加时,需要及时更新字段注释。SQL Server通过游标提供了对一个结果集进行逐行处理的能力，游标可看做一种特殊的指针，它与某个查询结果相联系，可以指向结果集的任意位置，以便对指定位置的数据进行处理。使用游标可以在查询数据的同时对数据进行处理。

在SQL Server中，有两类游标可以用于应用程序中：前端（客户端）游标和后端（服务器端）游标。服务器端游标是由数据库服务器创建和管理的游标，而客户端游标是由ODBC 和DB-Library 支持，在客户端实现的游标。

SQL Server对游标的使用要遵循“声明游标→打开游标→读取数据→关闭游标→删除游标”的过程。



## 索引

```sql
索引是根据表中一列或若干列按照一定顺序建立的列值与记录行之间的对应关系表。在数据库系统中建立索引主要有以下作用：
快速存取数据；
保证数据记录的唯一性；
实现表与表之间的参照完整性；
在使用ORDER BY、GROUP BY子句进行数据检索时，利用索引可以减少排序和分组的时间。

1．聚集索引
聚集索引将数据行的键值在表内排序并存储对应的数据记录，使得数据表物理顺序与索引顺序一致。SQL Server 2008是按B树（BTREE）方式组织聚集索引的，B树方式构建为包含了多个节点的一棵树。顶部的节点构成了索引的开始点，叫做根。
每个表只会有一个聚集索引。
由于数据记录按聚集索引键的次序存储，故聚集索引对查找记录很有效。

2．非聚集索引
非聚集索引完全独立于数据行的结构。SQL Server 2008也是按B树方式组织非聚集索引的，与聚集索引的不同之处在于：非聚集索引B树的叶节点不存放数据页信息，而是存放非聚集索引的键值，并且每个键值项都有指针指向包含该键值的数据行。
只有在表上创建聚集索引时，表内的行才按特定顺序存储，这些行按聚集索引键顺序存储。如果一个表只有非聚集索引，则它的数据行将按无序的堆集方式存储。


```























